<!DOCTYPE html>
<html lang="tr">
<head>
          <title>0x6 | Junior of All</title>
        <meta charset="utf-8" />


    <meta name="tags" content="python" />
    <meta name="tags" content="requests" />
    <meta name="tags" content="parser" />
    <meta name="tags" content="lxml" />

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">0x6 | Junior of All <strong></strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
              <li><a href="/category/ansible.html">ansible</a></li>
              <li><a href="/category/flask.html">flask</a></li>
              <li><a href="/category/linux.html">linux</a></li>
              <li class="active"><a href="/category/python.html">python</a></li>
              <li><a href="/category/vagrant.html">vagrant</a></li>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="/tsf-parser.html" rel="bookmark"
         title="Permalink to TSF Parser">TSF Parser</a></h2>
 
  </header>
  <footer class="post-info">
    <time class="published" datetime="2016-06-28T10:20:00+03:00">
      Sal 28 Haziran 2016
    </time>
    <address class="vcard author">
      By           <a class="url fn" href="/author/0x656e.html">0x656e</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p>Selamlar arkadaşlar bu postta twitterda bir arkadaşımın paylaştığı linkte bulunan verileri çekeceğiz.Bu kod beni baya bi uğraştırdı. Aslında uğraştırmaması gerekiyordu fakat ilk olarak parse etmek için regex kullanmayı düşündüm.Fakat regex ile yeterince hızlı olmuyordu bu işlem xpath kullanmak istedim işte tüm sorunlar bundan sonra başladı.Öncelikle çekeceğimiz linki vereyim. <a href="https://lisans.tsf.org.tr/online/main/kulupliste/">Tsf.org.tr</a>  Siteye girdiğinizde eğer bir külubü görüntülerseniz özel id atandığını göreceksiniz.Yani aslında arkaplanda post ile verileri alırken 206 id li veriyi çekiyor fakat adress bar da bu 100545254 şeklinde gözükmekte. Eğer bunu farketmeseydim her döngüde 1 artan bir değişkenle işimi halletmeye çalışacaktım.Bu işlem epey uzun oluyordu :)</p>
<p>Bende xpath ile o açılır menüde ki kulüplerin id lerini ve isimlerini aldım.Daha sonra bi def içinde gerekli olan sayfayı bulup ona göre döngüye devam ediyordu.</p>
<p>Fakat bu büyük bir soruna yol açtı bunu sadece 1 kere yapıyordu.Yani 25 sayfa aldıysa sonradan yeniden sayfalar açılırsa ( <strong> Ki bazı kulüpler 2600 sayfa  </strong>) bunu es geçiyordu.</p>
<p>Neyse kodumuzun ilk haline bakalım.(  <strong>Hataları olabilir bir süre sonra elleşmedim oraya hiç  </strong>)</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">html</span>
<span class="kn">import</span> <span class="nn">adddb</span>

<span class="n">disct</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">def</span> <span class="nf">analyze</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://lisans.tsf.org.tr/online/main/kulupliste/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">i</span>
    <span class="n">ac</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">lx</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">ac</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="k">global</span> <span class="n">sayfaid</span>
    <span class="n">sayfaid</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//div[@class=&quot;pagenavdiv&quot;]/a[@href]/text()&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">sayfaid</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sayfaid</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>
<span class="k">def</span> <span class="nf">multiplelist</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">number</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">http</span> <span class="o">=</span> <span class="s2">&quot;https://lisans.tsf.org.tr/online/main/kulupliste/</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">number</span><span class="p">)</span>
        <span class="n">ac</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">http</span><span class="p">)</span>
        <span class="n">lx</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">ac</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">global</span> <span class="n">isim</span><span class="p">,</span><span class="n">soyisim</span><span class="p">,</span><span class="n">dyil</span><span class="p">,</span><span class="n">il</span>
        <span class="n">isim</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//table[@class=&quot;lisans-table&quot;]//tr/td[2]/text()&#39;</span><span class="p">)</span>
        <span class="n">soyisim</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//table[@class=&quot;lisans-table&quot;]//tr/td[3]/text()&#39;</span><span class="p">)</span>
        <span class="n">dyil</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//table[@class=&quot;lisans-table&quot;]//tr/td[4]/text()&#39;</span><span class="p">)</span>
        <span class="n">il</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//table[@class=&quot;lisans-table&quot;]//tr/td[5]/text()&#39;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">pass</span>



<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://lisans.tsf.org.tr/online/main/kulupliste&quot;</span>
<span class="n">ac</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">lx</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">ac</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="nb">id</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;/html/body//option/@value&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">id</span><span class="p">:</span>

    <span class="k">if</span> <span class="n">analyze</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
        <span class="n">multiplelist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">sayfaid</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">u</span> <span class="o">==</span> <span class="s2">&quot;Son&quot;</span><span class="p">:</span>
                <span class="n">analyze</span><span class="p">(</span><span class="n">sayfaid</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
                <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">multiplelist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">u</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">isim</span><span class="p">)):</span>
                <span class="n">isimsoyisim</span> <span class="o">=</span> <span class="n">isim</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="n">soyisim</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">disct</span><span class="p">[</span><span class="n">isimsoyisim</span><span class="p">]</span> <span class="o">=</span> <span class="n">dyil</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">il</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>


<span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">disct</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">adddb</span><span class="o">.</span><span class="n">dbadd</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>


<p>Gördüğünüz gibi burada analiz ettikten sonra artık değişen birşey olmuyordu. Üstelik bütün siteyi parse ettikten sonra db ye ekliyordu bu da herhangi bir hata da hiç bir verinin kaydedilemeyeceği anlamına geliyordu.</p>
<p>Ama bundan önce bütün listelerin parse edilip tekrar aynı id ile birleştirilmesi koddan anlayabilirsiniz zaten buda bir sürü soruna sebep oldu.Verilerin tam kaydedilmemesi üst üste gelmesi yani verilerde eksik bulunuyordu. Neyse kod şu hale update edildi ( En sorunsuz sürüm sanırım )</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">html</span>
<span class="kn">import</span> <span class="nn">adddb</span>
<span class="k">def</span> <span class="nf">multiplelist</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">number</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">number</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>

            <span class="n">http</span> <span class="o">=</span> <span class="s2">&quot;https://lisans.tsf.org.tr/online/main/kulupliste/</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
            <span class="n">ac</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">http</span><span class="p">)</span>
            <span class="n">lx</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">ac</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="n">isim</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">soyisim</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">dyil</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">il</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">isim</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//table[@class=&quot;lisans-table&quot;]//tr/td[2]/text()&#39;</span><span class="p">)</span>
            <span class="n">soyisim</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//table[@class=&quot;lisans-table&quot;]//tr/td[3]/text()&#39;</span><span class="p">)</span>
            <span class="n">dyil</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//table[@class=&quot;lisans-table&quot;]//tr/td[4]/text()&#39;</span><span class="p">)</span>
            <span class="n">il</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//table[@class=&quot;lisans-table&quot;]//tr/td[5]/text()&#39;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">http</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">isim</span><span class="p">)):</span>
                <span class="n">isimsoyisim</span> <span class="o">=</span> <span class="n">isim</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="n">soyisim</span><span class="p">[</span><span class="n">f</span><span class="p">]</span>
                <span class="n">adddb</span><span class="o">.</span><span class="n">dbadd</span><span class="p">(</span><span class="n">isimsoyisim</span><span class="p">,</span><span class="n">dyil</span><span class="p">[</span><span class="n">f</span><span class="p">],</span><span class="n">il</span><span class="p">[</span><span class="n">f</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">pass</span>


<span class="n">sayfasayisi</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://lisans.tsf.org.tr/online/main/kulupliste&quot;</span>
<span class="n">ac</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">lx</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">ac</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="nb">id</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;/html/body//option/@value&#39;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;/html/body//option/text()&#39;</span><span class="p">)</span>


<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;([0-9]{0,9}).Sporcu&quot;</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">//</span><span class="mi">15</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">sayfasayisi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>


<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">u</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span><span class="n">sayfasayisi</span><span class="p">):</span>
    <span class="n">multiplelist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">u</span><span class="p">)</span>
</pre></div>


<p>Bu da iyi hoştu ama netim sağlam olmadığı için arkadaşlarda çalıştırdığımızda verileri tam olarak çekmiyordu toplamda 9000 küsür veri çekiyordu.Büyük ihtimal sunucumuz belli bir request den sonra bizi drop ediyordu ve bizde çok az veri yazabiliyorduk.</p>
<p>Neyse buna da bir çözüm bulduk.Daha önce Robin Dimyan bilmem ne :D adlı arkadaşın kodunda kullandığı tor reload kullandım.Test ettiğimde sorunsuz gözüküyordu fakat siteyi tam olarak çekemedim ne yazık ki.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span><span class="o">,</span><span class="nn">socks</span><span class="o">,</span><span class="nn">socket</span>
<span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">call</span>
<span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">html</span>

<span class="kn">import</span> <span class="nn">adddb</span><span class="o">,</span><span class="nn">re</span>


<span class="k">def</span> <span class="nf">tor_reload</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">call</span><span class="p">(</span><span class="s1">&#39;sudo systemctl reload tor&#39;</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Successfully Connected to New Tor Circuit!&quot;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Can&#39;t changed the Tor node, checking tor status and starting if doesn&#39;t working...&quot;</span><span class="p">)</span>
    <span class="n">socks</span><span class="o">.</span><span class="n">setdefaultproxy</span><span class="p">(</span><span class="n">socks</span><span class="o">.</span><span class="n">PROXY_TYPE_SOCKS5</span><span class="p">,</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">9050</span><span class="p">)</span>
    <span class="n">socket</span><span class="o">.</span><span class="n">socket</span> <span class="o">=</span> <span class="n">socks</span><span class="o">.</span><span class="n">socksocket</span>


<span class="k">def</span> <span class="nf">multiplelist</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">number</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">number</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>

            <span class="n">http</span> <span class="o">=</span> <span class="s2">&quot;https://lisans.tsf.org.tr/online/main/kulupliste/</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
            <span class="n">ac</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">http</span><span class="p">)</span>
            <span class="n">lx</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">ac</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="n">isim</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">soyisim</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">dyil</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">il</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">isim</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//table[@class=&quot;lisans-table&quot;]//tr/td[2]/text()&#39;</span><span class="p">)</span>
            <span class="n">soyisim</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//table[@class=&quot;lisans-table&quot;]//tr/td[3]/text()&#39;</span><span class="p">)</span>
            <span class="n">dyil</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//table[@class=&quot;lisans-table&quot;]//tr/td[4]/text()&#39;</span><span class="p">)</span>
            <span class="n">il</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//table[@class=&quot;lisans-table&quot;]//tr/td[5]/text()&#39;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">http</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">isim</span><span class="p">)):</span>
                <span class="n">isimsoyisim</span> <span class="o">=</span> <span class="n">isim</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="n">soyisim</span><span class="p">[</span><span class="n">f</span><span class="p">]</span>
                <span class="n">adddb</span><span class="o">.</span><span class="n">dbadd</span><span class="p">(</span><span class="n">isimsoyisim</span><span class="p">,</span><span class="n">dyil</span><span class="p">[</span><span class="n">f</span><span class="p">],</span><span class="n">il</span><span class="p">[</span><span class="n">f</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">pass</span>


<span class="n">sayfasayisi</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://lisans.tsf.org.tr/online/main/kulupliste&quot;</span>
<span class="n">ac</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">lx</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">ac</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="nb">id</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;/html/body//option/@value&#39;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;/html/body//option/text()&#39;</span><span class="p">)</span>


<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;([0-9]{0,9}).Sporcu&quot;</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">//</span><span class="mi">15</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">sayfasayisi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>


<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">u</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span><span class="n">sayfasayisi</span><span class="p">):</span>
    <span class="n">multiplelist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">u</span><span class="p">)</span>
    <span class="n">tor_reload</span><span class="p">()</span>
</pre></div>


<p>Bu arada burada kodda sayfa sayısını toplamsporcu//15+1 ile alıyorum.Hiç değilse daha sağlıklı oluyor.</p>
<p>Scriptte kullandığım diğer kodlar şu şekildedir.</p>
<p>adddb.py'ın dosya içeriği : </p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="k">def</span> <span class="nf">dbadd</span><span class="p">(</span><span class="n">isim</span><span class="p">,</span><span class="n">yil</span><span class="p">,</span><span class="n">il</span><span class="p">):</span>
    <span class="n">op</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;tsf.db&quot;</span><span class="p">)</span>
    <span class="n">cs</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO tsflicense(isim,dyil,il) VALUES (?,?,?)&quot;</span><span class="p">,(</span><span class="n">isim</span><span class="p">,</span><span class="n">yil</span><span class="p">,</span><span class="n">il</span><span class="p">,))</span>
    <span class="n">op</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="n">op</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>


<p>Not : Burada ki kodlar tamamen eğitim amaçlıdır.Kullanımınızdan doğan herhangi bir yasal sorunda mesuliyet kabul etmem.Yazı hakkında ki yasal sorunlar vs iletişime geçmek için : <a href="emailto:r4wn3ss@gmail.com">Email</a> </p>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>